
# Практическая часть

Общая схема стенда:



                                            |
                                            | uplink
                                            | eth0 nat
                                     +------+------+
                                     |             |
                                     | inetRouter  |
                                     |             |
                                     +------+------+
                                            | eth1
                                            | 192.168.255.1/30
                                            | 192.168.255.5/30
                                            | 192.168.255.9/30
                                            |
                                            |router-net
           +--------------------------------+--------------------------------+
           |                                |                                |
           |eth1                            |eth1                            |eth1
           |192.168.255.6/30                |192.168.255.2/30                |192.168.255.10/30
    +------+------+                  +------+------+                  +------+------+
    |             |                  |             |                  |             |
    |office1Router|                  |centralRouter|                  |office2Router|
    |             |                  |             |                  |             |
    +------+------+                  +------+------+                  +------+------+
           |eth3                            |eth2                            |eth3
           |192.168.2.65/26                 |192.168.0.1/28                  |192.168.1.129/26
           |                                |                                |
           |office1-test-server-net         |dir-net                         |office2-test-server-net
           |                                |                                |
           |eth1                            |eth1                            |eth1
           |192.168.2.66/26                 |192.168.0.2/28                  |192.168.1.130/26
    +------+------+                  +------+------+                  +------+------+
    |             |                  |             |                  |             |
    |office1Server|                  |centralServer|                  |office2Server|
    |             |                  |             |                  |             |
    +-------------+                  +-------------+                  +-------------+


### inetRouter

На ВМ inetRouter добавлены дополнительные адреса 192.168.255.5/30 и 192.168.255.9/30, так как в сети router-net 192.168.255.0/30
недостаточно адресов для организации связи с office1Router и office2Router. Для сетей офисов и центра прописаны маршруты:

    ip route add 192.168.0.0/24 via 192.168.255.2 dev eth1 # central nets via centralRouter
    ip route add 192.168.2.0/24 via 192.168.255.6 dev eth1 # office1 nets via office1Router
    ip route add 192.168.1.0/24 via 192.168.255.10 dev eth1 # office2 nets via office2Router

### centralRouter, office1Router, office2Router

Для office1Router и office2Router добавлены интерфейсы в сети router-net 192.168.255.6/30 и 192.168.255.10/30.
Маршрут по умолчанию настроен через inetRouter.
Разрешён форвардинг пакетов.

### centralServer, office1Server, office2Server

Настроен маршрут по умолчанию через соответствующий офисный маршрутизатор.



Проверка связности между серверами office2 и central:

    [root@office2Server ~]# tracepath -n 192.168.0.2
     1?: [LOCALHOST]                                         pmtu 1500
     1:  192.168.1.129                                         0.547ms 
     1:  192.168.1.129                                         0.560ms 
     2:  192.168.255.9                                         0.742ms 
     3:  192.168.255.2                                         0.970ms 
     4:  192.168.0.2                                           1.515ms reached
         Resume: pmtu 1500 hops 4 back 4 

Доступ в интернет с сервера central:

    [root@centralServer ~]# ping 8.8.8.8
    PING 8.8.8.8 (8.8.8.8) 56(84) bytes of data.
    64 bytes from 8.8.8.8: icmp_seq=1 ttl=59 time=65.9 ms
    64 bytes from 8.8.8.8: icmp_seq=2 ttl=59 time=64.5 ms
    64 bytes from 8.8.8.8: icmp_seq=3 ttl=59 time=63.1 ms
    64 bytes from 8.8.8.8: icmp_seq=4 ttl=59 time=63.0 ms
    64 bytes from 8.8.8.8: icmp_seq=5 ttl=59 time=63.0 ms
    ^C
    --- 8.8.8.8 ping statistics ---
    5 packets transmitted, 5 received, 0% packet loss, time 4008ms
    rtt min/avg/max/mdev = 63.019/63.941/65.969/1.181 ms


По выводу утилиты tracepath видно, что маршрут проходит через centralRouter и далее через inetRouter:

    [root@centralServer ~]# tracepath -n 8.8.8.8
     1?: [LOCALHOST]                                         pmtu 1500
     1:  192.168.0.1                                           1.252ms 
     1:  192.168.0.1                                           1.057ms 
     2:  192.168.255.1                                         0.746ms 
     3:  no reply



# Теоретическая часть

### Найти свободные подсети:  

 - в сети office1 192.168.2.0/24 нет свободных подсетей.  
 - в сети office2 192.168.1.0/24 нет свободных подсетей.  
 - в сети central 192.168.0.0/24 есть свободные подсети 192.168.0.16/28, 192.168.0.48/28, 192.168.0.128/25.  

### Посчитать сколько узлов в каждой подсети, включая свободные  

 Сеть office1  
  - 192.168.2.0/26 - dev: всего 64 адреса, доступно для использования 62, broadcast 192.168.2.63  
  - 192.168.2.64/26 - test servers: всего 64 адреса, доступно для использования 62, broadcast 192.168.2.127  
  - 192.168.2.128/26 - managers: всего 64 адреса, доступно для использования 62, broadcast 192.168.2.191  
  - 192.168.2.192/26 - office hardware: всего 64 адреса, доступно для использования 62, broadcast 192.168.2.255  

 Сеть office2  
  - 192.168.1.0/25 - dev: всего 128 адресов, доступно для использования 126, broadcast 192.168.1.127  
  - 192.168.1.128/26 - test servers: всего 64 адреса, доступно для использования 62, broadcast 192.168.1.191  
  - 192.168.1.192/26 - office hardware: всего 64 адреса, доступно для использования 62, broadcast 192.168.1.255  

 Сеть central  
  - 192.168.0.0/28 - directors: всего 16 адресов, доступно для использования 14, broadcast 192.168.0.15  
  - 192.168.0.32/28 - office hardware: всего 16 адресов, доступно для использования 14, broadcast 192.168.0.47  
  - 192.168.0.64/26 - wifi: всего 64 адреса, доступно для использования 62, broadcast 192.168.0.127  
